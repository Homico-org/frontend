name: Deploy

on:
  push:
    branches: [dev, main]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  deploy:
    name: Trigger Render Deploy Hook
    runs-on: ubuntu-latest

    steps:
      - name: Resolve deploy hook URL
        id: resolve
        shell: bash
        run: |
          if [ "${GITHUB_REF}" = "refs/heads/dev" ]; then
            URL="${{ secrets.RENDER_DEPLOY_HOOK_URL_DEV }}"
            if [ -z "${URL}" ]; then URL="${{ secrets.RENDER_DEPLOY_HOOK_FRONTEND_DEV }}"; fi
          elif [ "${GITHUB_REF}" = "refs/heads/main" ]; then
            URL="${{ secrets.RENDER_DEPLOY_HOOK_URL_MAIN }}"
            if [ -z "${URL}" ]; then URL="${{ secrets.RENDER_DEPLOY_HOOK_FRONTEND_PROD }}"; fi
          else
            URL=""
          fi

          echo "url=${URL}" >> "$GITHUB_OUTPUT"

      - name: Trigger deploy
        if: steps.resolve.outputs.url != ''
        run: |
          curl -fsSL -X POST "${{ steps.resolve.outputs.url }}"

      - name: Skip (no deploy hook configured)
        if: steps.resolve.outputs.url == ''
        run: |
          echo "No Render deploy hook secret configured for this branch; skipping deploy."
